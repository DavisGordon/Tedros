<!DOCTYPE HTML>
<html>
	<head>
		<title>Covid Sem Fome - Painel do voluntário</title>
		<meta charset="utf-8" />
		<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
		<meta http-equiv="Pragma" content="no-cache" />
		<meta http-equiv="Expires" content="0" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="../assets/css/main.css" />
		<noscript><link rel="stylesheet" href="../assets/css/noscript.css" /></noscript>
		
	
	</head>
	<body class="is-preload">

		<!-- Wrapper -->
			<div id="wrapper" class="divided">
				<section class="banner style1 orient-left content-align-left image-position-right fullscreen onload-image-fade-in onload-content-fade-right">
						<div class="content">
							<h2>Painel do voluntário</h2>
							Bem-vindo <strong><span id="userName" ></span></strong>!
							<br><br>
							
							<ul class="actions stacked">
								<li><a href="#acaoId" class="button fit small wide smooth-scroll-middle">Participar em ação</a></li>
								<li><a href="#volun" class="button fit small wide smooth-scroll-middle">Meus dados pessoais</a></li>
								<li><a href="javascript: logout()" class="button fit small primary wide smooth-scroll-middle">Sair</a></li>
							</ul>
							
						</div>
						<div class="image">
							<img src="../images/13.jpg" alt="" />
						</div>
					</section>
					
					<!-- Definition List -->
					<section class="wrapper style1 align-left" id="acaoId">
						<div class="inner">
							<header>
								<h2>Ações / Campanhas</h2>
							</header>
							<div class="content align-center" id="acoesContent"></div>
						</div>
					</section>
					
					
					<section class="wrapper style2 align-left" id="volun">
						<header>
							<h3>Meus dados pessoais</h3>
						</header>
						<div class="content">
							<form name="frm" id="frm" method="post" action="../api/painel/user/alter">
								<div class="fields">
									<div class="field half">
										<label for="name">Nome</label>
										<input type="text" name="name" id="name"  value="" />
									</div>
									<div class="field half">
										<label for="name">Profissão</label>
										<input type="text" name="profissao" id="profissao"  value="" />
									</div>
									
									<div class="field half">
										<label for="identidade">Identidade</label>
										<input type="text" name="identidade" id="identidade" value="" />
									</div>
									<div class="field half">
										<label for="cpf">CPF</label>
										<input type="text" name="cpf" id="cpf" value="" />
									</div>
									<div class="field">
										<label for="telefone">Nacionalidade</label>
										<input type="text" name="nacionalidade" id="nacionalidade" value="" />
									</div>
									<div class="field half">
										<label for="email">Email</label>
										<input type="email" name="email" id="email" value="" />
									</div>
									<div class="field half">
										<label for="telefone">Telefone / Whatsapp</label>
										<input type="text" name="telefone" id="telefone" value="" />
									</div>
									<div class="field half">
										<input type="radio" id="solteiro" name="estadoCivil" value="Solteiro" />
										<label for="solteiro">Solteiro</label>
										<input type="radio" id="casado" name="estadoCivil" value="Casado"  />
										<label for="casado">Casado</label>
									</div>
									<div class="field half">
										<input type="radio" id="m" name="sexo" value="M" />
										<label for="m">Masculino</label>
									
										<input type="radio" id="f" name="sexo"value="F"  />
										<label for="f">Feminino</label>
									</div>
									
									<div class="field half">
										<label for="tipoLogradouro">Tipo Logradouro (Rua/Avenida...)</label>
										<input type="text" name="tipoLogradouro" id="tipoLogradouro"  value="" />
									</div>
									<div class="field half">
										<label for="logradouro">Logradouro</label>
										<input type="text" name="logradouro" id="logradouro"  value="" />
									</div>
									<div class="field half">
										<label for="bairro">Bairro</label>
										<input type="text" name="bairro" id="bairro"  value="" />
									</div>
									<div class="field half">
										<label for="complemento">Complemento (Número/Apartamento...)</label>
										<input type="text" name="complemento" id="complemento"  value="" />
									</div>
									<div class="field half">
										<label for="cidade">Cidade</label>
										<input type="text" name="cidade" id="cidade"  value="" />
									</div>
									<div class="field half">
										<label for="uf">Estado (UF)</label>
										<select name="uf" id="uf"></select>
									</div>
									<div class="field half">
										<label for="cep">CEP</label>
										<input type="text" name="cep" id="cep"  value="" />
									</div>
									
									
									
								</div>
								<ul class="actions">
									<li><input type="submit" name="submit" id="submit" value="Enviar" /></li>
								</ul>
							</form>
						</div>
					</section>
					
					
			</div>
	<!-- Scripts -->
			<script src="../assets/js/jquery.min.js"></script>
			<script src="../assets/js/jquery.scrollex.min.js"></script>
			<script src="../assets/js/jquery.scrolly.min.js"></script>
			<script src="../assets/js/browser.min.js"></script>
			<script src="../assets/js/breakpoints.min.js"></script>
			<script src="../assets/js/util.js"></script>
			<script src="../assets/js/main.js"></script>
    		<script src="../assets/js/jquery.form.js"></script> 
    		
    		<script type="text/javascript">
    		$(document).ready(function() { 
    			
    			$('#frm').ajaxForm( { beforeSubmit: validate, success: showResponse  } ); 
    			 
    			carregarEstados();
    			ltpf();
    			
    		});
    		var tpf;
    		var tpj;
    		function ltpf(){
    			$.ajax
    		    ({ 
    		        url: '../api/painel/tiposAjuda/PF',
    		        type: 'get',
    		        dataType:'json',
    		        headers : {'Content-Type' : 'application/json'},
    		        success: function(result)
    		        {
    		        	if(result.code == "200"){
    		        		tpf = result.data;
    		        	}else{
    		        		alert(result.message);
    		        	}
    		        	ltpj();
    		    	}
    			}); 
    		}
    		
    		function ltpj(){
    			$.ajax
    		    ({ 
    		        url: '../api/painel/tiposAjuda/PJ',
    		        type: 'get',
    		        dataType:'json',
    		        headers : {'Content-Type' : 'application/json'},
    		        success: function(result)
    		        {
    		        	if(result.code == "200"){
    		        		tpj = result.data;
    		        	}else{
    		        		alert(result.message);
    		        	}
    		        	carregarAcoes();
    		    	}
    			}); 
    		}
    		
    		function logout(){
    			$.ajax
    		    ({ 
    		        url: '../api/painel/logout',
    		        type: 'get',
    		        dataType:'json',
    		        headers : {'Content-Type' : 'application/json'},
    		        success: function(result)
    		        {
    		        	if(result.code == "200"){
    		        		location.href = '../voluntario.html';
    		        	}else{
    		        		alert(result.message);
    		        	}
    		    	}
    			}); 
    		}
    		
    		function carregarEstados(){
    			$.ajax
    		    ({ 
    		        url: '../api/painel/ufs',
    		        type: 'get',
    		        dataType:'json',
    		        headers : {'Content-Type' : 'application/json'},
    		        success: function(result)
    		        {
    		        	$('#uf').append('<option value="">Selecione</option>');
    		        	if(result.data){
   	        				$.each(result.data, function(index,obj){
   	        				 $('#uf').append('<option value="' + obj.id + '">' + obj.descricao + '</option>');
   	        				});
   	        			}	
    		        	carregarDadosPessoais();
    		    	}
    			}); 
    		}
    		
    		function carregarDadosPessoais(){
    			$.ajax
    		    ({ 
    		        url: '../api/painel/user',
    		        type: 'get',
    		        dataType:'json',
    		        headers : {'Content-Type' : 'application/json'},
    		        success: function(result)
    		        {
    		        	processarUser(result);
    		    	}
    			}); 
    		}
    		
    		function participar(btn, acao){
    			$(btn).each(function() {
    			    this.data("href", this.attr("href"))
    			        .attr("href", "javascript:void(0)")
    			        .attr("disabled", "disabled");
    			});
    			$.ajax
    		    ({ 
    		        url: '../api/painel/acao/participar/'+acao,
    		        type: 'post',
    		        dataType:'json',
    		        headers : {'Content-Type' : 'application/json'},
    		        success: function(result)
    		        {
    		        	processarAcoes(result);
    		    	}
    			}); 
    		}
    		
    		function sair(btn, acao){
    			$(btn).each(function() {
    			    this.data("href", this.attr("href"))
    			        .attr("href", "javascript:void(0)")
    			        .attr("disabled", "disabled");
    			});
    			$.ajax
    		    ({ 
    		        url: '../api/painel/acao/sair/'+acao,
    		        type: 'delete',
    		        dataType:'json',
    		        headers : {'Content-Type' : 'application/json'},
    		        success: function(result)
    		        {
    		        	processarAcoes(result);
    		    	}
    			}); 
    		}
    		
    		function carregarAcoes(){
    			$.ajax
    		    ({ 
    		        url: '../api/painel/acoes',
    		        type: 'get',
    		        dataType:'json',
    		        headers : {'Content-Type' : 'application/json'},
    		        success: function(result)
    		        {
    		        	processarAcoes(result);
    		    	}
    			}); 
    		}
    		
    		function processarAcoes(result){
    			if(result.code == "200"){
	        		 if(result.data){
	        			 var content = "";
	        			 var frms = [];
	        			$.each(result.data, function(index,obj){
	        				
	        				frms.push('frm'+index);
	        				
	        				content += ('<header>');
	        				content += ('<h1>' + obj.titulo + '</h1>');
	        				content += ('<p>' + obj.data + ', ' + obj.status + ', Inscritos(' + obj.qtdVoluntariosInscritos + '), Max(' + obj.qtdMaxVoluntarios + '), Min(' + obj.qtdMinVoluntarios + ')</p>');
	        				content += ('</header>');
	        				content += ('<p>' + obj.descricao + '</p>');
	        				
	        				if(obj.status=='Agendada' && (tpf || tpj)){
	        					content += ('<div class="content">');
		        				content += ('<h2>Quero participar</h2>');
		        				content += ('<form name="frm'+index+'" id="frm'+index+'" method="post" action="../api/painel/acao/participar/"><p>');
		        				content += ('<input type="hidden" name="id" id="id" value="'+obj.id+'" /> ');
	        					content += ('<div class="fields">');
		        				if(tpf){
			        				content += ('<div class="field half" style="text-align:left;"><h3>Como pessoa fisica:</h3>');
			        				
			        				$.each(tpf, function(index2,obj2){
			        					var chk = '';
			        					$.each(obj.tiposAjuda, function(index3,obj3){
			        						if(obj2.id==obj3.id){
			        							chk = 'checked';
			        						}
			        					});
			        					content += ('<input type="checkbox" '+chk+' name="tiposAjuda" id="tiposAjudapf'+obj.id+'_'+index2+'" value="'+obj2.id+'" /> ');
			        					content += ('<label for="tiposAjudapf'+obj.id+'_'+index2+'">'+obj2.descricao+'</label><br>');
			        				});
			        				content += ('</p></div>');
		        				}
		        				if(tpj){
			        				content += ('		<div class="field half" style="text-align:left;"><h3>Como pessoa juridica:</h3><p>');
			        				$.each(tpj, function(index2,obj2){
			        					var chk = '';
			        					$.each(obj.tiposAjuda, function(index3,obj3){
			        						if(obj2.id==obj3.id){
			        							chk = 'checked';
			        						}
			        					});
			        					content += ('<input type="checkbox" '+chk+' name="tiposAjuda" id="tiposAjudapj'+obj.id+'_'+index2+'" value="'+obj2.id+'" />');
			        					content += ('<label for="tiposAjudapj'+obj.id+'_'+index2+'">'+obj2.descricao+'</label><br>');
			        				});
			        				content += ('</p></div>');
		        				}
		        				content += ('	</div>');
		        				content += ('	<ul class="actions">');
		        				content += ('		<li><input type="submit" name="submit" id="submit" value="Participar" /></li>');
		        				
		        				if(obj.inscrito){
	                           		content += ('<li><a id="pa'+obj.id+'" href="javascript: sair(\'pa'+obj.id+'\', '+ obj.id +')" class="button fit small wide smooth-scroll-middle">Sair da ação</a></li>');
	                            }
		        				
		        				content += ('</ul>');
		        				content += ('</form>');
		        				content += ('</div>');
	        				}
                            content += ('<hr />');
	        				});
		        					
	        			 $("#acoesContent").html(content);
	        			 
	        			 frms.forEach(function(value){
	        				 $('#'+value).ajaxForm( { beforeSubmit: validateTpa, success: showResponseTpa  } );
	        			 });
	        		 }
	        	}else{
	        		alert(result.message);
	        	}
    		}
    		
    		function processarUser(result){
    			if(result.code == "200"){
	        		 if(result.data){
	        			 $("#userName").html(result.data.nome);
	        			 $('#name').val(result.data.nome);
	        			 $('#profissao').val(result.data.profissao);
	        			 $('#identidade').val(result.data.identidade);
	        			 $('#cpf').val(result.data.cpf);
	        			 $('#nacionalidade').val(result.data.nacionalidade);
	        			 $('#email').val(result.data.email);
	        			 $('#telefone').val(result.data.telefone);
	        			 if(result.data.estadoCivil && result.data.estadoCivil=='Casado'){
	        				 $("#casado").prop("checked", true);
	        			 }
	        			 if(result.data.estadoCivil && result.data.estadoCivil=='Solteiro'){
	        				 $("#solteiro").prop("checked", true);
	        			 }
	        			 if(result.data.sexo && result.data.sexo=='M'){
	        				 $("#m").prop("checked", true);
	        			 }
	        			 if(result.data.sexo && result.data.sexo=='F'){
	        				 $("#f").prop("checked", true);
	        			 }
	        			 $('#tipoLogradouro').val(result.data.tipoLogr);
	        			 $('#logradouro').val(result.data.logradouro);
	        			 $('#complemento').val(result.data.complemento);
	        			 $('#bairro').val(result.data.bairro);
	        			 $('#cidade').val(result.data.cidade);
	        			 $('#cep').val(result.data.cep);
	        			 
	        			 $('#uf option[value="'+result.data.ufid+'"]').prop('selected', true);
	        			 
	        			 
	        		 }
	        	}else{
	        		alert(result.message);
	        	}
    		}
    		
    		function validateTpa(formData, jqForm, options) { 
    		    
    		    var form = jqForm[0]; 
    		    if (form.tiposAjuda[0]=='') { 
    		        alert('Por favor selecionar uma forma de como deseja ajudar.'); 
    		        return false; 
    		    } 
    		}
    		
			function validate(formData, jqForm, options) { 
				var campos =  "";
    		    var form = jqForm[0]; 
    		    
    		    if (!form.name.value) { 
    		        campos += "Nome"; 
    		    } 
    		    
    		    if (!form.profissao.value) { 
    		    	if(campos!="") campos += ", ";
    		        campos += "Profissão"; 
    		    } 
    		    
    		    if (!form.identidade.value) { 
    		    	if(campos!="") campos += ", ";
    		        campos += "Identidade"; 
    		    } 
    		    
    		    if (!form.cpf.value) { 
    		    	if(campos!="") campos += ", ";
    		        campos += "CPF"; 
    		    } 
    		    
    		    if (!form.nacionalidade.value) { 
    		    	if(campos!="") campos += ", ";
    		        campos += "Nacionalidade"; 
    		    } 
    		    
    		    if (!form.email.value) { 
    		    	if(campos!="") campos += ", ";
    		        campos += "Email"; 
    		    } 
    		    
    		    if (!document.getElementById("casado").checked && !document.getElementById("solteiro").checked){
    		    	if(campos!="") campos += ", ";
    		        campos += "Casado ou Solteiro"; 
    		    }
    		    
    		    if (!form.tipoLogradouro.value) { 
    		    	if(campos!="") campos += ", ";
    		        campos += "Tipo Logradouro"; 
    		    } 
    		    
    		    if (!form.logradouro.value) { 
    		    	if(campos!="") campos += ", ";
    		        campos += "Logradouro"; 
    		    } 
    		    
    		    if (!form.bairro.value) { 
    		    	if(campos!="") campos += ", ";
    		        campos += "Bairro"; 
    		    } 
    		    
    		    if (!form.complemento.value) { 
    		    	if(campos!="") campos += ", ";
    		        campos += "Complemento"; 
    		    } 
    		    
    		    if (!form.cidade.value) { 
    		    	if(campos!="") campos += ", ";
    		        campos += "Cidade"; 
    		    } 
    		    
    		    if (!$("#uf option:selected").val()) { 
    		    	if(campos!="") campos += ", ";
    		        campos += "Estado (UF)"; 
    		    } 
    		    
    		    if (!form.cep.value) { 
    		    	if(campos!="") campos += ", ";
    		        campos += "CEP"; 
    		    } 
    		    
    		    if (campos != "" ) { 
    		        alert('Por favor informar os campos: '+campos); 
    		        return false; 
    		    } 
    		}
    		
    		function showResponse(result, statusText, xhr, $form)  { 
    			if(result.code == "200"){
    		    	processarUser(result)
    		    	alert("Dados alterados!");
    			}else{
	        		alert(result.message);
	        	}
    		} 
    		
    		function showResponseTpa(result, statusText, xhr, $form)  { 
    			if(result.code == "200"){
    				processarAcoes(result);
    		    	alert("Obrigado sua intenção em ajudar foi registrada e em breve entraremos em contato ou se desejar entre em contato conosco!");
    			}else{
	        		alert(result.message);
	        	}
    		} 
    		
    		
    		
    		
    		
    		</script>

</body>
</html>