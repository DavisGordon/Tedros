<!DOCTYPE HTML>
<html>
	<head>
		<title>Covid Sem Fome - Painel do voluntário</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="../assets/css/main.css" />
		<noscript><link rel="stylesheet" href="../assets/css/noscript.css" /></noscript>
		
	
	</head>
	<body class="is-preload">

		<!-- Wrapper -->
			<div id="wrapper" class="divided">
				<section class="banner style1 orient-left content-align-left image-position-right fullscreen onload-image-fade-in onload-content-fade-right">
						<div class="content">
							<h2>Painel do voluntário</h2>
							Bem-vindo <strong><span id="userName" ></span></strong>!
							<br><br>
							
							<ul class="actions stacked">
								<li><a href="#acoes" class="button fit small wide smooth-scroll-middle">Participar em acão</a></li>
								<li><a href="#volun" class="button fit small wide smooth-scroll-middle">Meus dados pessoais</a></li>
								<li><a href="javascript: logout()" class="button fit small primary wide smooth-scroll-middle">Sair</a></li>
							</ul>
							
						</div>
						<div class="image">
							<img src="../images/gallery/fulls/11.jpg" alt="" />
						</div>
					</section>
					
					<!-- Definition List -->
					<section class="wrapper style1 align-left" id="acoes">
						<div class="inner">
							<header>
								<h2>Acões</h2>
							</header>
							<div class="content align-center" id="acoesContent"></div>
						</div>
					</section>
					
					
					<section class="wrapper style2 align-left" id="volun">
										<header>
											<h3>Meus dados pessoais</h3>
										</header>
										<div class="content">
											<form name="frm" id="frm" method="post" action="../api/painel/user/alter">
												<div class="fields">
													<div class="field">
														<label for="name">Nome</label>
														<input type="text" name="name" id="name"  value="" />
													</div>
													<div class="field half">
														<label for="email">Email</label>
														<input type="email" name="email" id="email" value="" />
													</div>
													<div class="field half">
														<label for="telefone">Telefone / Whatsup</label>
														<input type="text" name="telefone" id="telefone" value="" />
													</div>
													<div class="field half">
														<input type="radio" id="m" name="sexo" value="M" />
														<label for="m">Masculino</label>
													</div>
													<div class="field half">
														<input type="radio" id="f" name="sexo"value="F"  />
														<label for="f">Feminino</label>
													</div>
													<div class="field">
														<label for="voluntario">Desejo voluntariar-me para:</label>
														<select name="voluntario" id="voluntario">
															<option value="">- Selecione -</option>
															<option value="1">Cozinha - Preparar comida</option>
															<option value="2">Cozinha - Preparar marmita</option>
															<option value="3">Entrega</option>
														</select>
													</div>
													
												</div>
												<ul class="actions">
													<li><input type="submit" name="submit" id="submit" value="Enviar" /></li>
												</ul>
											</form>
										</div>
									</section>
			</div>
	<!-- Scripts -->
			<script src="../assets/js/jquery.min.js"></script>
			<script src="../assets/js/jquery.scrollex.min.js"></script>
			<script src="../assets/js/jquery.scrolly.min.js"></script>
			<script src="../assets/js/browser.min.js"></script>
			<script src="../assets/js/breakpoints.min.js"></script>
			<script src="../assets/js/util.js"></script>
			<script src="../assets/js/main.js"></script>
    		<script src="../assets/js/jquery.form.js"></script> 
    		
    		<script type="text/javascript">
    		$(document).ready(function() { 
    			
    			$('#frm').ajaxForm( { beforeSubmit: validate, success: showResponse  } ); 
    			 
    			carregarDadosPessoais();
    			carregarAcoes();
    			
    		});
    		
    		function logout(){
    			$.ajax
    		    ({ 
    		        url: '../api/painel/logout',
    		        type: 'get',
    		        dataType:'json',
    		        headers : {'Content-Type' : 'application/json'},
    		        success: function(result)
    		        {
    		        	if(result.code == "200"){
    		        		location.href = '../voluntario.html';
    		        	}else{
    		        		alert(result.message);
    		        	}
    		    	}
    			}); 
    		}
    		
    		function carregarDadosPessoais(){
    			$.ajax
    		    ({ 
    		        url: '../api/painel/user',
    		        type: 'get',
    		        dataType:'json',
    		        headers : {'Content-Type' : 'application/json'},
    		        success: function(result)
    		        {
    		        	processarUser(result);
    		    	}
    			}); 
    		}
    		
    		function participar(btn, acao){
    			$(btn).each(function() {
    			    this.data("href", this.attr("href"))
    			        .attr("href", "javascript:void(0)")
    			        .attr("disabled", "disabled");
    			});
    			$.ajax
    		    ({ 
    		        url: '../api/painel/acao/participar/'+acao,
    		        type: 'post',
    		        dataType:'json',
    		        headers : {'Content-Type' : 'application/json'},
    		        success: function(result)
    		        {
    		        	processarAcoes(result);
    		    	}
    			}); 
    		}
    		
    		function sair(btn, acao){
    			$(btn).each(function() {
    			    this.data("href", this.attr("href"))
    			        .attr("href", "javascript:void(0)")
    			        .attr("disabled", "disabled");
    			});
    			$.ajax
    		    ({ 
    		        url: '../api/painel/acao/sair/'+acao,
    		        type: 'delete',
    		        dataType:'json',
    		        headers : {'Content-Type' : 'application/json'},
    		        success: function(result)
    		        {
    		        	processarAcoes(result);
    		    	}
    			}); 
    		}
    		
    		function carregarAcoes(){
    			$.ajax
    		    ({ 
    		        url: '../api/painel/acoes',
    		        type: 'get',
    		        dataType:'json',
    		        headers : {'Content-Type' : 'application/json'},
    		        success: function(result)
    		        {
    		        	processarAcoes(result);
    		    	}
    			}); 
    		}
    		
    		function processarAcoes(result){
    			if(result.code == "200"){
	        		 if(result.data){
	        			 var content = "";
	        			 
	        			$.each(result.data, function(index,obj){
	        				 
	        				content += ('<header>');
	        				content += ('<h1>' + obj.titulo + '</h1>');
	        				content += ('<p>' + obj.data + ', ' + obj.status + ', Inscritos(' + obj.qtdVoluntariosInscritos + '), Max(' + obj.qtdMaxVoluntarios + '), Min(' + obj.qtdMinVoluntarios + ')</p>');
	        				content += ('</header>');
	        				content += ('<p>' + obj.descricao + '</p>');
	        				if(obj.status=='Agendada'){
								if(!obj.inscrito){
	                           	 content += ('<a id="pa'+obj.id+'" href="javascript: participar(\'pa'+obj.id+'\', '+ obj.id +')" class="button fit small wide smooth-scroll-middle">Participar</a>');
	                            }else{
	                           	 content += ('<a id="pa'+obj.id+'" href="javascript: sair(\'pa'+obj.id+'\', '+ obj.id +')" class="button fit small wide smooth-scroll-middle">Sair da ação</a>');
	                            }
	        				}
                            content += ('<hr />');
	        				});
	        			 $("#acoesContent").html(content);
	        		 }
	        	}else{
	        		alert(result.message);
	        	}
    		}
    		
    		function processarUser(result){
    			if(result.code == "200"){
	        		 if(result.data){
	        			 $("#userName").html(result.data.nome);
	        			 $('#name').val(result.data.nome);
	        			 $('#email').val(result.data.email);
	        			 $('#telefone').val(result.data.telefone);
	        			 if(result.data.sexo && result.data.sexo=='M'){
	        				 $("#m").prop("checked", true);
	        			 }
	        			 if(result.data.sexo && result.data.sexo=='F'){
	        				 $("#f").prop("checked", true);
	        			 }
	        			 $('#voluntario option[value='+result.data.tipoVoluntario+']').attr('selected','selected');
	        			 
	        		 }
	        	}else{
	        		alert(result.message);
	        	}
    		}
    		
    		function validate(formData, jqForm, options) { 
    		    
    		    var form = jqForm[0]; 
    		    if ((!form.name.value || !form.email.value || $('#voluntario').fieldValue()[0]=='')) { 
    		        alert('Por favor informar o seu nome, email e o no que pretende se voluntariar.'); 
    		        return false; 
    		    } 
    		}
    		
    		function showResponse(result, statusText, xhr, $form)  { 
    			if(result.code == "200"){
    		    	processarUser(result)
    		    	alert("Dados alterados!");
    			}else{
	        		alert(result.message);
	        	}
    		} 
    		
    		</script>

</body>
</html>